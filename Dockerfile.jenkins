FROM maven:3.8.5-openjdk-11 as maven-build

WORKDIR /testlum/
COPY . .
RUN mvn clean install -DskipTests -Pquality-checking

FROM openjdk:11-alpine

ARG JAR_FILE=target/testlum-with-dependencies.jar

WORKDIR /testlum/

COPY --from=maven-build /testlum/${JAR_FILE} testlum.jar

ENTRYPOINT ["java", "-DTESTING_IN_PIPELINE=true", "-jar", "testlum.jar"]