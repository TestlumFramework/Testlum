<scenario xmlns="http://www.knubisoft.com/e2e/testing/model/scenario" onlyThis="true">

    <overview>
        <description>Self clickhouse SQL test</description>
        <name>Clickhouse test scenario</name>
    </overview>
    <tags>
        <tag>self_test</tag>
    </tags>

    <migrate comment="Prepare information from news_init patch (5 records)" name="CLICKHOUSE"
             alias="clickhouse-one">
        <patches>clickhouse_patch_1.sql</patches>
    </migrate>
    <migrate comment="Prepare information from news_init patch (5 records)" name="CLICKHOUSE"
             alias="clickhouse-two">
        <patches>clickhouse_patch_1.sql</patches>
    </migrate>

    <clickhouse comment="Execute mixed postgres commands (SELECT/INSERT/DELETE).
  Expect to see content from expected_2"
                file="expected_2.json"
                alias="clickhouse-one">
        <query>SELECT * FROM t_user ORDER BY id</query>
        <query>INSERT INTO t_user (*)
            VALUES (9, 'testuser9', 'email9@gmail.com', 1, 'testuser9', 'testuser9',
            '$2a$10$neQFs2lytkzy12dAj./dS.gWbzEKRzaEpgfAbb2Z1SeIMWF4WYCou',
            1, null, 0, null, '2021-09-29 18:06:16.000000', null, null, null)
        </query>
        <query>SELECT id FROM t_user WHERE id=9</query>
        <query>ALTER TABLE test_db.t_user DELETE WHERE 1=1</query>
        <query>SELECT * FROM t_user ORDER BY id</query>
    </clickhouse>

    <clickhouse comment="Execute mixed postgres commands (SELECT/INSERT/DELETE).
  Expect to see content from expected_2"
                file="expected_2.json"
                alias="clickhouse-two">
        <query>SELECT * FROM t_user ORDER BY id</query>
        <query>INSERT INTO t_user (*)
            VALUES (9, 'testuser9', 'email9@gmail.com', 1, 'testuser9', 'testuser9',
            '$2a$10$neQFs2lytkzy12dAj./dS.gWbzEKRzaEpgfAbb2Z1SeIMWF4WYCou',
            1, null, 0, null, '2021-09-29 18:06:16.000000', null, null, null)
        </query>
        <query>SELECT id FROM t_user WHERE id=9</query>
        <query>ALTER TABLE test_db.t_user DELETE WHERE 1=1</query>
        <query>SELECT * FROM t_user ORDER BY id</query>
    </clickhouse>
</scenario>

