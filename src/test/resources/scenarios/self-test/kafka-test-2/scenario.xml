<scenario xmlns="http://www.knubisoft.com/e2e/testing/model/scenario" active="false">

    <overview>
        <description>Self kafka test #2</description>
        <name>Kafka test scenario #2</name>

    </overview>
    <tags>
        <tag>self_test</tag>
    </tags>
    <kafka comment="Receive 2 times and send 1 time"
           alias="kafka">
        <receive topic="queue">
            <file>expected_1.json</file>
        </receive>

        <receive topic="queue">
            <value>
                []
            </value>
        </receive>

        <send topic="queue">
            <file>body_1.json</file>
        </send>
    </kafka>

    <kafka comment="Receive then send and receive 2 time"
           alias="kafka">
        <receive topic="queue">
            <file>expected_2.json</file>
        </receive>

        <send topic="queue">
            <file>body_1.json</file>
        </send>

        <receive topic="queue">
            <value>
                [ {
                "key" : null,
                "value" : "{\n \"squadName\": \"Super hero squad\",\n \"homeTown\": \"Metro City\",\n \"formed\":
                2016,\n \"secretBase\": \"Super tower\",\n \"active\": true\n}",
                "correlationId" : null,
                "headers" : { }
                } ]
            </value>
        </receive>
    </kafka>

    <kafka comment="Receive then send and receive 2 time"
           alias="kafka">
        <send topic="queue2" correlationId="343gfrvs-dh4aakgksa-cgo60dmsw-sdf4gj62">
            <file>body_2.json</file>
        </send>

        <send topic="queue3" correlationId="dfskogdfa9sd-rekjdfnkv-sdfkjewnd8-erkfdn">
            <file>body_4.json</file>
        </send>

        <receive topic="queue2" timeoutMillis="1200">
            <value>
                [ {
                "key" : null,
                "value" : "{\n \"squadName\": \"Still rule cool\",\n \"homeTown\": \"Metro Tower\",\n \"formed\":
                2018,\n \"secretBase\": \"Rower\",\n \"active\": false\n}",
                "correlationId" : "343gfrvs-dh4aakgksa-cgo60dmsw-sdf4gj62",
                "headers" : { }
                } ]
            </value>
        </receive>

        <receive topic="queue3">
            <file>expected_3.json</file>
        </receive>
    </kafka>


    <kafka comment="Receive then send with headers"
           alias="kafka">
        <send topic="queue2" correlationId="lknfre303-dfkm39ej2-dskkeem-dskomdwh">
            <file>body_3.json</file>
            <headers>
                <header name="name1" value="value1"/>
                <header name="name2" value="value2"/>
                <header name="name3" value="value3"/>
            </headers>
        </send>

        <send topic="queue3">
            <file>body_4.json</file>
            <headers>
                <header name="name4" value="value4"/>
            </headers>
        </send>

        <receive topic="queue2">
            <value>
                [ {
                "key" : null,
                "value" : "{\n \"rule\": \"1+1+3=5\",\n \"number\": 2\n}",
                "correlationId" : "lknfre303-dfkm39ej2-dskkeem-dskomdwh",
                "headers" : {
                "name3" : "value3",
                "name2" : "value2",
                "name1" : "value1"
                }
                } ]
            </value>
        </receive>

        <receive topic="queue3">
            <value>
                [ {
                "key" : null,
                "value" : "{\n \"data\": \"Are you\",\n \"make\": true\n}",
                "correlationId" : null,
                "headers" : {
                "name4" : "value4"
                }
                } ]
            </value>
        </receive>
    </kafka>


    <kafka comment="Receive then send with headers and keys"
           alias="kafka">
        <send topic="queue2" correlationId="lknfre303-dfkm39ej2-dskkeem-dskomdwh">
            <file>body_3.json</file>
            <key>123</key>
            <headers>
                <header name="name1" value="value1"/>
                <header name="name2" value="value2"/>
                <header name="name3" value="value3"/>
            </headers>
        </send>

        <send topic="queue3">
            <file>body_4.json</file>
            <key>456</key>
            <headers>
                <header name="name4" value="value4"/>
            </headers>
        </send>

        <receive topic="queue2" timeoutMillis="5000">
            <value>
                [ {
                "key" : "123",
                "value" : "{\n \"rule\": \"1+1+3=5\",\n \"number\": 2\n}",
                "correlationId" : "lknfre303-dfkm39ej2-dskkeem-dskomdwh",
                "headers" : {
                "name3" : "value3",
                "name2" : "value2",
                "name1" : "value1"
                }
                } ]
            </value>
        </receive>

        <receive topic="queue3" timeoutMillis="5000">
            <value>
                [ {
                "key" : "456",
                "value" : "{\n \"data\": \"Are you\",\n \"make\": true\n}",
                "correlationId" : null,
                "headers" : {
                "name4" : "value4"
                }
                } ]
            </value>
        </receive>
    </kafka>

</scenario>
